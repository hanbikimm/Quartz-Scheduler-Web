-- 데이터베이스

DROP DATABASE SCHEDULER_PROJECT;
CREATE DATABASE SCHEDULER_PROJECT;
USE SCHEDULER_PROJECT;

-- 테이블, 시퀀스
DROP TABLE IF EXISTS MEMBER;
DROP TABLE IF EXISTS JOB_LABEL;
DROP TABLE IF EXISTS JOB_LOG;

CREATE TABLE `MEMBER` (
    `MEMBER_ID`   INT(11) NOT NULL,
    `USERNAME`    VARCHAR(50) NOT NULL,
    `PASSWORD`    VARCHAR(100) NOT NULL,
    `EMAIL`       VARCHAR(100) NOT NULL,
    `NAME`        VARCHAR(50) NOT NULL,
    `ROLE`        VARCHAR(50) NOT NULL,
    `CREATED_DT`  TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `UPDATED_DT`  TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT PK_MEMBER PRIMARY KEY (MEMBER_ID),
    CONSTRAINT UK_MEMBER_USERNAME UNIQUE KEY (USERNAME),
    CONSTRAINT UK_MEMBER_EMAIL UNIQUE KEY (EMAIL)
);

CREATE TABLE `JOB_LABEL` (
    `LABEL_ID`    INT(11) NOT NULL,
    `MEMBER_ID`   INT(11) NOT NULL,
    `JOB_NAME`    VARCHAR(50) NOT NULL,
    `JOB_GROUP`   VARCHAR(50) NOT NULL,
    `JOB_CLASS`   VARCHAR(100) NOT NULL,
    `JOB_DESC`    VARCHAR(100) NULL,
    `JOB_STATE`   VARCHAR(50) NOT NULL,
    `CREATED_DT`  TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `UPDATED_DT`  TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT PK_JOB_LABEL PRIMARY KEY (LABEL_ID),
    CONSTRAINT UK_JOB_LABEL UNIQUE KEY (JOB_NAME, JOB_GROUP),
    CONSTRAINT FK_JOB_LABEL FOREIGN KEY (MEMBER_ID) REFERENCES MEMBER (MEMBER_ID) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE `JOB_LOG` (
    `LOG_ID`       INT(11) NOT NULL,
    `LABEL_ID`     INT(11) NOT NULL,
    `EXEC_RESULT`  VARCHAR(50) NOT NULL,
    `START_DT`    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `END_DT`      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT PK_JOB_LOG PRIMARY KEY (LOG_ID),
    CONSTRAINT FK_JOB_LOG FOREIGN KEY (LABEL_ID) REFERENCES JOB_LABEL (LABEL_ID) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE SEQUENCE SEQ_MEMBER_ID;
CREATE SEQUENCE SEQ_LABEL_ID;
CREATE SEQUENCE SEQ_LOG_ID;
